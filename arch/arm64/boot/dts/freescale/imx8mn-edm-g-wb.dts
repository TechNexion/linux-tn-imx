// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2021 TechNexion Ltd.
 *
 * Author: Andy Lin <andy.lin@technexion.com>
 *
 */

/dts-v1/;

#include "imx8mn-edm-g.dtsi"

/ {
	model = "TechNexion EDM-G-IMX8MN and WB baseboard";
	compatible = "fsl,imx8mn-edm-g", "fsl,imx8mn";

	leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";

		led {
			label = "gpio-led";
			gpios = <&pca9555_a23 1 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "heartbeat";
		};
	};

	regulators {
		reg_usdhc2_vmmc: regulator-usdhc2 {
			compatible = "regulator-fixed";
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_reg_usdhc2_vmmc>;
			regulator-name = "VSD_3V3";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			gpio = <&gpio2 19 GPIO_ACTIVE_HIGH>;
			enable-active-high;
			startup-delay-us = <100>;
			off-on-delay-us = <12000>;
		};

		reg_usb_otg_vbus: usb_otg_vbus {
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_otg_vbus>;
			compatible = "regulator-fixed";
			regulator-name = "usb_otg_vbus";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			gpio = <&gpio1 10 GPIO_ACTIVE_LOW>;
			enable-active-low;
		};

		reg_lvds_pwr: regulator_lvdspwr {
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_lvds0_pwr>;
			compatible = "regulator-fixed";
			regulator-name = "lvds0_vdden";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			gpio = <&gpio1 7 GPIO_ACTIVE_HIGH>;
			enable-active-high;
			regulator-always-on;
			status = "okay";
		};
		reg_lvds_backlight_pwr: regulator_lvdsblpwr {
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_lvds0_backlight_pwr>;
			compatible = "regulator-fixed";
			regulator-name = "lvds0_bl_en";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			gpio = <&gpio1 12 GPIO_ACTIVE_HIGH>;
			enable-active-high;
			regulator-always-on;
			status = "okay";
		};
	};

	lvds_backlight: lvds_backlight {
		compatible = "pwm-backlight";
		pwms = <&pwm2 0 50000>;
		brightness-levels = <0 36 72 108 144 180 216 255>;
		default-brightness-level = <6>;
		status = "okay";
	};

	sound_wm8960: sound-wm8960 {
		compatible = "fsl,imx-audio-wm8960";
		model = "wm8960-audio";
		cpu-dai = <&sai2>;
		codec-master;
		audio-codec = <&codec_wm8960>;
		audio-routing =
			"Headphone Jack", "HP_L",
			"Headphone Jack", "HP_R",
			"Ext Spk", "SPK_LP",
			"Ext Spk", "SPK_LN",
			"Ext Spk", "SPK_RP",
			"Ext Spk", "SPK_RN",
			"LINPUT1", "Main MIC",
			"RINPUT1", "Main MIC",
			"Main MIC", "MICB";
		/* JD2: hp detect high for headphone*/
		hp-det = <2 0>;
	};
};

&iomuxc {
	imx8mn-edm-g {
		pinctrl_nfc: nfcgrp {
			fsl,pins = <
				MX8MN_IOMUXC_SAI3_TXD_GPIO5_IO1     0x19 /* IRQ */
			>;
		};

		pinctrl_csi_rst: csi1_rst_grp {
			fsl,pins = <
				MX8MN_IOMUXC_GPIO1_IO05_GPIO1_IO5       0x19
				MX8MN_IOMUXC_GPIO1_IO14_CCMSRCGPCMIX_CLKO1  0x59
			>;
		};

		pinctrl_touch_irq: touch_irqgrp {
			fsl,pins = <
				MX8MN_IOMUXC_GPIO1_IO13_GPIO1_IO13		0x41 /* Touch INT */
			>;
		};

		pinctrl_touch_reset: touch_rstgrp {
			fsl,pins = <
				MX8MN_IOMUXC_SAI5_MCLK_GPIO3_IO25		0x41 /* TOUCH_nRST, LVDS1_VDDEN */
			>;
		};
	};
};

&usdhc2 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
	pinctrl-1 = <&pinctrl_usdhc2_100mhz>, <&pinctrl_usdhc2_gpio>;
	pinctrl-2 = <&pinctrl_usdhc2_200mhz>, <&pinctrl_usdhc2_gpio>;
	cd-gpios = <&gpio2 12 GPIO_ACTIVE_LOW>;
	bus-width = <4>;
	vmmc-supply = <&reg_usdhc2_vmmc>;
	status = "okay";
};

&mipi_dsi {
	status = "okay";

	panel@0 {
		reg = <0>;
		compatible = "tn,dsi2lvds-panel";
		dsi,flags = <0x0007>;
		dsi,format = <0>;
		dsi,lanes = <4>;
		panel-width-mm  = <217>;
		panel-height-mm = <135>;
		bus-format = <0x100a>;	/* MEDIA_BUS_FMT_RGB888_1X24 */
		bus-flags = <1>;
		refresh-rate = <60>;
		rotate = <0>;
		/* horz-flip; */
		/* vert-flip; */

		panel-timing {
			clock-frequency = <68900000>;
			hactive = <1280>;
			vactive = <800>;
			hfront-porch = <40>;
			hsync-len = <80>;
			hback-porch = <40>;
			vfront-porch = <3>;
			vsync-len = <10>;
			vback-porch = <10>;
			/* flags = DISPLAY_FLAGS_HSYNC_HIGH | DISPLAY_FLAGS_VSYNC_HIGH */
			vsync-active = <1>;
			hsync-active = <1>;
		};
	};
};

&i2c1 {
	eeprom_baseboard: eeprom@51 {
		compatible = "atmel,24c02";
		reg = <0x51>;
		pagesize = <16>;
		status = "okay";
	};

	dsi_lvds_bridge: sn65dsi84@2d {
		compatible = "ti,sn65dsi84";
		#gpio-cells = <2>;
		pinctrl-0 = <&pinctrl_mipi_dsi_en>;
		enable-gpios = <&gpio3 9 GPIO_ACTIVE_HIGH>;
		reg = <0x2d>;
		sn65dsi84,addresses = <0x09 0x0A 0x0B 0x0D
								0x10 0x11 0x12 0x13
								0x18 0x19 0x1A 0x1B
								0x20 0x21 0x22 0x23
								0x24 0x25 0x26 0x27
								0x28 0x29 0x2A 0x2B
								0x2C 0x2D 0x2E 0x2F
								0x30 0x31 0x32 0x33
								0x34 0x35 0x36 0x37
								0x38 0x39 0x3A 0x3B
								0x3C 0x3D 0x3E 0x0D>;

		sn65dsi84,values = </* reset and clock registers */
							0x00 0x05 0x10 0x00
							/* DSI registers */
							0x26 0x00 0x2a 0x00
							/* LVDS registers */
							0x78 0x00 0x03 0x00

							/* video registers */
							/* cha-al-len-l, cha-al-len-h, chb-al-len-l, chb-al-len-h */
							0x00 0x05 0x00 0x00
							/* cha-v-ds-l, cha-v-ds-h, chb-v-ds-l, chb-v-ds-h */
							0x00 0x00 0x00 0x00
							/* cha-sdl, cha-sdh, chb-sdl, chb-sdh */
							0x21 0x00 0x00 0x00
							/* cha-hs-pwl, cha-hs-pwh, chb-hs-pwl, chb-hs-pwh */
							0x50 0x00 0x00 0x00
							/* cha-vs-pwl, cha-vs-pwh, chb-vs-pwl, chb-vs-pwh */
							0x0a 0x00 0x00 0x00
							/*cha-hbp, chb-hbp, cha-vbp, chb-vbp*/
							0x28 0x00 0x00 0x00
							/* cha-hfp, chb-hfp, cha-vfp, chb-vfp*/
							0x00 0x00 0x00 0x00

							0x00 0x00 0x00 0x01>;
		status = "okay";
	};
};

&i2c2 {
	codec_wm8960: wm8960@1a {
		compatible = "wlf,wm8960";
		reg = <0x1a>;
		#sound-dai-cells = <0>;
		clocks = <&clk IMX8MN_CLK_SAI2>; /* Clock from internal */
		clock-names = "mclk";
		wlf,shared-lrclk;
		wlf,fixed-mclk;
		status = "okay";
	};

	typec_hd3ss3220: hd3ss3220@67 {
		compatible = "ti,tusb320", "ti,hd3ss3220";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_hd3ss3220_irq>;
		reg = <0x67>;
		vbus-supply = <&reg_usb_otg_vbus>;
		tusb320,int-gpio = <&gpio2 10 GPIO_ACTIVE_LOW>;
		tusb320,select-mode = <0>;
		tusb320,dfp-power = <0>;
	};

	pca9555_a21: pca9555@21 {
		compatible = "nxp,pca9555";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pca9555_a21_irq>;
		reg = <0x21>;
		gpio-controller;
		#gpio-cells = <2>;
		interrupt-controller;
		#interrupt-cells = <2>;
		interrupt-parent = <&gpio1>;
		interrupts = <15 IRQ_TYPE_LEVEL_LOW>;
		status = "okay";
		gpio-line-names = "EXPOSURE_TRIG_IN1", "FLASH_OUT1", "INFO_TRIG_IN1", "CAM_SHUTTER1",
							"XVS1", "PWR1_TIME0", "PWR1_TIME1", "PWR1_TIME2",
							"EXPOSURE_TRIG_IN2", "FLASH_OUT2", "INFO_TRIG_IN2", "CAM_SHUTTER2",
							"XVS2", "PWR2_TIME0", "PWR2_TIME1", "PWR2_TIME2";
	};

	pca9555_a23: pca9555@23 {
		compatible = "nxp,pca9555";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pca9555_a23_irq>;
		reg = <0x23>;
		gpio-controller;
		#gpio-cells = <2>;
		interrupt-controller;
		#interrupt-cells = <2>;
		interrupt-parent = <&gpio4>;
		interrupts = <28 IRQ_TYPE_LEVEL_LOW>;
		status = "okay";
		gpio-line-names = "M2_DISABLE_N", "LED_EN", "", "",
							"", "", "", "USB_OTG_OC",
							"EXT_GPIO8", "EXT_GPIO9", "", "",
							"", "CSI1_PDB", "CSI2_PDB", "PD_FAULT";
	};

	tevi_ov5640_0: tevi_ov5640_mipi@3c {
		compatible = "ovti,ov5640";
		reg = <0x3c>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_csi_rst>;
		clocks = <&clk IMX8MN_CLK_CLKO1>;
		clock-names = "xclk";
		assigned-clocks = <&clk IMX8MN_CLK_CLKO1>;
		assigned-clock-parents = <&clk IMX8MN_CLK_24M>;
		assigned-clock-rates = <24000000>;
		csi_id = <0>;
		powerdown-gpios = <&pca9555_a21 2 GPIO_ACTIVE_HIGH>;
		rst-gpios = <&gpio1 5 GPIO_ACTIVE_HIGH>;
		mclk = <24000000>;
		mclk_source = <0>;
		mipi_csi;
		status = "okay";

		port {
			tevi_ov5640_mipi_0_ep: endpoint {
				remote-endpoint = <&mipi_csi0_ep>;
				data-lanes = <1 2>;
				clock-lanes = <0>;
			};
		};
	};
};

&i2c3 {
	pn547: pn547@2a {
		compatible = "nxp,pn547";
		reg = <0x2a>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_nfc>;
		clock-frequency = <100000>;
		interrupt-gpios = <&gpio5 1 0>;
		status = "okay";
	};
};

&ecspi3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_ecspi3 &pinctrl_ecspi3_cs>;
	fsl,spi-num-chipselects = <1>;
	cs-gpios = <&gpio5 25 GPIO_ACTIVE_LOW>;
	status = "okay";

	spidev1: spi@0 {
		reg = <0>;
		compatible = "rohm,dh2228fv";
		spi-max-frequency = <500000>;
	};
};

&pwm2 { /* LVDS0_BL_PWM */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_lvds0_backlight_pwm>;
	status = "okay";
};

&usbotg1 {
	dr_mode = "otg";
	status = "okay";
};

&sai2 { /* AUD_A */
	#sound-dai-cells = <0>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_sai2>;
	assigned-clocks = <&clk IMX8MN_AUDIO_PLL1>, <&clk IMX8MN_AUDIO_PLL2>, <&clk IMX8MN_CLK_SAI2>;
	assigned-clock-parents = <0>, <0>, <&clk IMX8MN_AUDIO_PLL1_OUT>;
	assigned-clock-rates = <786432000>, <722534400>, <12288000>;
	status = "okay";
};

&mipi_csi_1 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	port@0 {
		reg = <0>;
		mipi_csi0_ep: endpoint {
			remote-endpoint = <&tevi_ov5640_mipi_0_ep>;
			data-lanes = <2>;
			csis-hs-settle = <13>;
			csis-clk-settle = <2>;
			csis-wclk;
		};
	};
};

&cameradev {
	status = "okay";
};

&isi_0 {
	status = "okay";

	cap_device {
		status = "okay";
	};
};

